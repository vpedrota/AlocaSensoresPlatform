<template>
    <v-card class="mx-auto" variant="outlined" >
        <v-card-item >
            <div >
                <div  class="text-overline mb-1">
                    <h2>Resumo</h2>
                </div>
            </div>
            <div>
              <div v-if="!verificaVazio()">  Nenhum ponto ou polígono inserido. </div>
              <div  v-if="verificaVazio()" v-for="(item, index) in tableData">
                <v-row>
                  <v-col cols="4">
                    <v-text-field @change="func('id', index, item.id)" v-model="item.id" label="Input 1" outlined dense></v-text-field>
                  </v-col>
                  <v-col cols="4">
                    <v-text-field  @change="func('pop', index, item.pop)"  v-model="item.pop" label="População" outlined dense></v-text-field>
                  </v-col>
                  <v-col cols="4">
                    <v-text-field @change="func('impacto',index, item.impacto)" v-model="item.impacto" label="Impacto" outlined dense></v-text-field>
                  </v-col>
                </v-row>
              </div>
              <div style="margin-top: 10px">
                <v-btn @click="sendToApi()" variant="tonal">
                  Enviar
                </v-btn>
              </div>
            </div>
        </v-card-item>
    </v-card>
    <modal :titulo="titulo" :mensagem="mensagem" :open="modal"></modal>
  </template>
  
  <script lang="ts" setup>

  import { ref, watch, onMounted, watchEffect} from 'vue';
  import {OSM, Vector as VectorSource} from 'ol/source.js';
  import Modal from '@/components/Modal.vue'
  import axios from 'axios';


  let tableData = ref([])
  let modal = ref(true)
  let titulo = ref("Aviso")
  let mensagem = ref("Parâmetros inválidos")

  const props = defineProps(['featuresObjectUpdate', 'changed']); 
  
  function verificaVazio(){
   
    if(props.featuresObjectUpdate){
      return true
    }
      
    return false
  }

  function func(campo, index, valor) {
    props.featuresObjectUpdate.getFeatures()[index].set(campo, valor)
    tableData.value = props.featuresObjectUpdate.getFeatures().map((feature) => {
      return {"id": feature.get('id'), "pop":feature.get('pop'), "impacto": feature.get('impacto')};
    })
  }

  watch(() => props.changed, (novoValor: VectorSource) => {
    console.log(33)
    tableData.value = props.featuresObjectUpdate.getFeatures().map((feature) => {
      return {"id": feature.get('id'), "pop":feature.get('pop'), "impacto": feature.get('impacto')};
    })
  })

  function sendToApi(){
    if(!verificaVazio()){
      modal.value = !modal.value
      return
    }

    const objetoParaEnviar = {
	"features": [
		{
			"geometry": {
				"coordinates": [
					[
						-46.60443884913072,
						-23.572819388394105
					],
					[
						-46.627730305379664,
						-23.6191823665818
					]
				],
				"type": "MultiPoint"
			},
			"properties": {},
			"type": "Feature"
		},
		{
			"geometry": {
				"coordinates": [
					[
						[
							-46.62433309110651,
							-23.52869823116538
						],
						[
							-46.60443884913072,
							-23.572819388394105
						]
					],
					[
						[
							-46.60931232874014,
							-23.577193862468093
						],
						[
							-46.60443884913072,
							-23.572819388394105
						]
					],
					[
						[
							-46.61438504204861,
							-23.58180991534433
						],
						[
							-46.60443884913072,
							-23.572819388394105
						]
					],
					[
						[
							-46.599569620630355,
							-23.582514024632104
						],
						[
							-46.60443884913072,
							-23.572819388394105
						]
					],
					[
						[
							-46.59750778828526,
							-23.582968699364454
						],
						[
							-46.60443884913072,
							-23.572819388394105
						]
					],
					[
						[
							-46.58623669757619,
							-23.58430330473213
						],
						[
							-46.60443884913072,
							-23.572819388394105
						]
					],
					[
						[
							-46.584299211899925,
							-23.58451271616507
						],
						[
							-46.60443884913072,
							-23.572819388394105
						]
					],
					[
						[
							-46.589146209266225,
							-23.585890007435978
						],
						[
							-46.60443884913072,
							-23.572819388394105
						]
					],
					[
						[
							-46.621477689882404,
							-23.595290517513387
						],
						[
							-46.627730305379664,
							-23.6191823665818
						]
					],
					[
						[
							-46.606229189105825,
							-23.60882291129663
						],
						[
							-46.627730305379664,
							-23.6191823665818
						]
					],
					[
						[
							-46.624853335717724,
							-23.533578216580615
						],
						[
							-46.60443884913072,
							-23.572819388394105
						]
					],
					[
						[
							-46.60769292877645,
							-23.61232957863249
						],
						[
							-46.627730305379664,
							-23.6191823665818
						]
					],
					[
						[
							-46.62762104100255,
							-23.612717856603958
						],
						[
							-46.627730305379664,
							-23.6191823665818
						]
					],
					[
						[
							-46.627199194670375,
							-23.61585577672534
						],
						[
							-46.627730305379664,
							-23.6191823665818
						]
					],
					[
						[
							-46.62795576930658,
							-23.622358645595103
						],
						[
							-46.627730305379664,
							-23.6191823665818
						]
					],
					[
						[
							-46.62918673185733,
							-23.626002968123778
						],
						[
							-46.627730305379664,
							-23.6191823665818
						]
					],
					[
						[
							-46.629477737362315,
							-23.62655075559101
						],
						[
							-46.627730305379664,
							-23.6191823665818
						]
					],
					[
						[
							-46.61229077352863,
							-23.540273987331805
						],
						[
							-46.60443884913072,
							-23.572819388394105
						]
					],
					[
						[
							-46.61294209317399,
							-23.540673601964325
						],
						[
							-46.60443884913072,
							-23.572819388394105
						]
					],
					[
						[
							-46.593358968482924,
							-23.544442446114576
						],
						[
							-46.60443884913072,
							-23.572819388394105
						]
					],
					[
						[
							-46.62756135815523,
							-23.549091103509742
						],
						[
							-46.60443884913072,
							-23.572819388394105
						]
					],
					[
						[
							-46.640461641414696,
							-23.549091009632402
						],
						[
							-46.60443884913072,
							-23.572819388394105
						]
					],
					[
						[
							-46.63891291960515,
							-23.549793640678438
						],
						[
							-46.60443884913072,
							-23.572819388394105
						]
					],
					[
						[
							-46.59994312192265,
							-23.55107541586701
						],
						[
							-46.60443884913072,
							-23.572819388394105
						]
					],
					[
						[
							-46.62856243558732,
							-23.557198872061345
						],
						[
							-46.60443884913072,
							-23.572819388394105
						]
					]
				],
				"type": "MultiLineString"
			},
			"properties": {},
			"type": "Feature"
		},
		{
			"geometry": {
				"coordinates": [
					[
						-46.62433309110651,
						-23.52869823116538
					],
					[
						-46.624853335717724,
						-23.533578216580615
					],
					[
						-46.61229077352863,
						-23.540273987331805
					],
					[
						-46.61294209317399,
						-23.540673601964325
					],
					[
						-46.593358968482924,
						-23.544442446114576
					],
					[
						-46.62756135815523,
						-23.549091103509742
					],
					[
						-46.640461641414696,
						-23.549091009632402
					],
					[
						-46.63891291960515,
						-23.549793640678438
					],
					[
						-46.59994312192265,
						-23.55107541586701
					],
					[
						-46.62856243558732,
						-23.557198872061345
					],
					[
						-46.60443884913072,
						-23.572819388394105
					],
					[
						-46.60931232874014,
						-23.577193862468093
					],
					[
						-46.61438504204861,
						-23.58180991534433
					],
					[
						-46.599569620630355,
						-23.582514024632104
					],
					[
						-46.59750778828526,
						-23.582968699364454
					],
					[
						-46.58623669757619,
						-23.58430330473213
					],
					[
						-46.584299211899925,
						-23.58451271616507
					],
					[
						-46.589146209266225,
						-23.585890007435978
					],
					[
						-46.621477689882404,
						-23.595290517513387
					],
					[
						-46.606229189105825,
						-23.60882291129663
					],
					[
						-46.60769292877645,
						-23.61232957863249
					],
					[
						-46.62762104100255,
						-23.612717856603958
					],
					[
						-46.627199194670375,
						-23.61585577672534
					],
					[
						-46.627730305379664,
						-23.6191823665818
					],
					[
						-46.62795576930658,
						-23.622358645595103
					],
					[
						-46.62918673185733,
						-23.626002968123778
					],
					[
						-46.629477737362315,
						-23.62655075559101
					]
				],
				"type": "MultiPoint"
			},
			"properties": {
				"impacto": [
					1.17,
					7.82,
					9.65,
					6.5,
					1.4,
					0.65,
					4.07,
					0.95,
					3.38,
					2.15,
					2.33,
					2.03,
					1.2,
					1.36,
					1.82,
					0.55,
					0.55,
					1.62,
					1.52,
					2.45,
					1.07,
					0.27,
					0.67,
					0.73,
					1.92,
					0.38,
					0.78,
					0.58,
					0.65
				],
				"p": 2,
				"pop": [
					82456,
					75917,
					86741,
					108919,
					104206,
					102336,
					132608,
					195010,
					294740,
					288825,
					134085,
					215608,
					129477,
					129591,
					151473,
					121495,
					127501,
					128313,
					127619,
					141349,
					182413,
					214040,
					226125,
					218560,
					219372,
					218398,
					214551,
					196939,
					196173
				]
			},
			"type": "Feature"
		}
	],
	"type": "FeatureCollection"
}

    axios.post('http://localhost:80', objetoParaEnviar)
    .then(response => {
      console.log(response.data);
    })
    .catch(error => {
      console.error(error);
    });

  }

  </script>

  <style>


  .input-field {
    width: 100%;
  }
  </style>